# Team Retrospective â€” 2026-02-27

**Facilitator:** Coulson  
**Participants:** Hill Â· Barton Â· Romanoff Â· Fury Â· Fitz Â· Ralph  
**Scope:** Interactive Menu Migration (Phases 1â€“6), UI Consistency Bugs, Bug Hunt, Process Directives

**Board Status at Retro Time:** âœ… 0 open issues Â· âœ… 0 open PRs Â· 689 tests passing

---

## ğŸŸ¢ What Went Well

### Hill (C# Dev)
**`IMenuNavigator` interface is a genuine win.** The abstraction itself landed cleanly â€” `IMenuNavigator` / `MenuOption<T>` / `FakeMenuNavigator` is a textbook testability pattern. We can script any menu flow in tests without touching a keyboard. `FakeMenuNavigator` with `EnqueueSelection()` / `EnqueueConfirm()` is expressive and readable. This design decision will pay dividends every time we add a new menu.

**`ConsoleMenuNavigator` is tight for its size.** 155 lines to handle scrollable arrow-key navigation, viewport math, ANSI cursor management, and a CI fallback to numbered `ReadLine` when stdin is redirected â€” that's a solid feature-to-line ratio. The `IsInputRedirected` fallback in particular was essential; without it every CI run would have hung.

**PR #626 bug hunt fixes merged clean.** 13 display/engine bugs fixed in one PR, all merged, 689 tests passing. The discipline of scoping the bug hunt to "file issues first, fix in a dedicated PR" rather than interleaving fixes with discovery kept the diff coherent and reviewable.

**The directive is finally in `decisions.md`.** "Implementation work is never complete if there are open Issues or PRs that relate to the work being done." Getting that into the canonical ledger means future sessions have it as a hard constraint to load on startup. That was overdue.

### Barton (Systems Dev)
**The bug hunt was a genuine win, and the process held up.** PRs #625, #626, #627 each closed clean â€” no re-opened issues, no re-regressions on the bugs that were fixed. That's meaningful given how entangled the systems layer is. When PassiveEffectProcessor, SetBonusManager, and CombatEngine all have cross-cutting interactions, fixing one bug without introducing a second is not trivial. The team did that across 19 bugs.

**The simulation test suite is paying dividends.** `CombatBalanceSimulationTests` and `LootDistributionSimulationTests` caught at least two balance-adjacent bugs silently before they became issues. No regression in enemy win-rate distribution this iteration. Running 100 simulated battles per enemy type is the right model.

**The `ICombatEngine` abstraction held up under menu migration pressure.** When the rest of the team was doing the IMenuNavigator work, combat was wired through `StubCombatEngine` in tests and the live `CombatEngine` in game. That boundary meant menu refactoring never once touched a systems file â€” zero cross-domain regressions from Phases 1â€“6.

### Romanoff (Tester)
**The deep bug hunt was the highlight of the iteration.** Collaborating with Hill and Barton on a focused, structured hunt â€” not just fixing symptoms but systematically cataloguing 19 unique bugs â€” felt like the team finally treating quality as a first-class activity rather than an afterthought. Filing 21 issues (catching 2 duplicates ourselves before they caused confusion) and closing everything across three clean PRs is the kind of closure I want to see every iteration.

**689 tests passing is a real number.** It's not inflated. Each test earns its place. The test suite caught regressions that would have shipped â€” the arrow-key duplication bug in particular would have been invisible to manual testing under the right timing conditions. The suite paid for itself this cycle.

**The "never complete with open issues/PRs" directive is exactly right.** The Boss calling out 12 open issues and 4 open PRs simultaneously was uncomfortable, but it was correct. Having that framed as a hard team directive means I can now point to it when flagging incomplete work.

### Fury (Content Writer)
**The content infrastructure held up under construction pressure.** While the team spent six phases tearing out and rebuilding input handling, the content layer â€” `RoomDescriptions.cs`, `DisplayService.cs`, the intro narrative â€” stayed intact and mostly unchanged. That's a win by omission: the right abstraction boundaries meant UI surgery didn't bleed into content pools.

**The class card display is now legitimately presentable.** Before the interactive menu work, class selection was a numbered list. Now it renders as visual cards with trait descriptions, stat modifiers, and icons. The visual upgrade gives the content something worth being displayed in.

**The room description pools are in genuinely good shape for Floors 1â€“5.** Floors 1â€“3 each have 16 entries. Floors 4â€“5 are at 16 and 16. The context-aware pools (Shallow, Armory, Volcanic, Undead) cover all five `RoomContext` states with distinct voices per band.

### Fitz (DevOps)
**Pipeline held under pressure.** The CI suite ran across 166+ merged PRs without a single false-positive gate failure. `squad-ci.yml` covered build, test, coverage threshold, RNG audit, JSON schema validation, and closes-reference enforcement â€” all in one workflow. Every merge that landed on `master` was clean.

**The `Closes #N` enforcement step actually worked.** During the bug hunt, every one of Romanoff, Hill, and Barton's PRs (#625, #626, #627) had proper `Closes #N` references in both the commit subject and the PR body. Process compliance went from "aspirational" to "automated warning on every PR."

**Protected branch guard prevented `.ai-team/` drift.** `squad-main-guard.yml` blocked `.ai-team/` files from landing on `main` every time someone's branch included team state. Zero manual cleanup was required on `main`.

### Ralph (Work Monitor)
**The board is clean.** No open issues, no open PRs. After the chaos peak (12 open issues + 4 open PRs simultaneously), ending at 0/0 is a real win. It wasn't a fluke â€” it was recovered intentionally.

**The deep bug hunt executed cleanly from a queue standpoint.** 21 issues filed, 2 duplicate closes handled quickly, PRs #625, #626, #627 all merged in sequence on the same day. The team ran three parallel PRs without creating merge conflicts, which tells me the territorial discipline is improving.

**The directive got committed.** PR #602 â€” "work not complete with open Issues or PRs" â€” is now in `.ai-team/decisions.md` and in a real commit. From a queue-monitoring perspective, having that as a hard rule rather than a suggestion changes my job. I can call a stop confidently instead of having to argue for it.

---

## ğŸ”´ What Could Be Improved

### Hill (C# Dev)
**`IMenuNavigator` is injected into `GameLoop` and `CombatEngine` but never called.** `GameLoop._navigator` and `CombatEngine._navigator` are stored but have zero actual call sites. The navigator only fires inside `DisplayService`. We wired the plumbing everywhere but only opened the tap in one place. The `TODO` in `DisplayService.cs:14` ("wire up navigator call-sites â€” issue #586") is still open. This means `GameLoop` is still making raw `_input.ReadLine()` calls at 10 places â€” shop input, armory choice, crafting â€” that were supposed to be migrated. We called the migration "done" too early.

**The ANSI cursor-up off-by-one needed a second PR.** `ConsoleMenuNavigator` shipped with a cursor positioning bug that required `#588` as a follow-up fix. This should have been caught in local manual testing before the first PR merged. We didn't have a "does the menu actually render correctly when navigating" checklist, just a "does it compile and do tests pass" bar. For display code, that's not sufficient.

**Duplication bugs required multiple rounds of iteration.** The arrow-key menu duplication bugs, the class select showing Ranger repeatedly, the Rogue indentation, the Warrior icon inconsistency, the card border misalignment â€” these were not complex bugs individually, but they required multiple separate fix PRs over multiple sessions. The pattern is clear: display output was being reviewed by reading code, not by running the game and looking at it.

**`DisplayService.cs` and `GameLoop.cs` are god objects.** `DisplayService.cs` is 1,481 lines. `GameLoop.cs` is 1,434 lines. At this size, two agents editing either file in the same session is a guaranteed merge conflict. It's also why the P1-4 merge sequence rule exists â€” we needed a process workaround for a structural problem in the code. These files need to be split, not worked around.

**One test is still failing.** `RecordRunEnd_CalledForCombatDeath_HistoryContainsEntry` â€” 1 test failing in the suite we're calling "689 passing." The headline number is technically wrong. This has apparently persisted through multiple sessions. That's a small thing that will quietly erode confidence in the test suite number if it stays broken.

### Barton (Systems Dev)
**The 12-open-issues / 4-open-PR situation exposed a coordination failure.** From where I sit, the backlog pile-up happened because systems work was being filed as issues without any check on whether related work was already in-flight. Issues #504â€“#531 were all combat/passive/loot fixes â€” they landed in a wave and nobody owned the merge sequence. The P1-4 merge sequence rule was added after the collision, not before.

**`CombatEngine.cs` is structurally at risk.** 1,659 lines is survivable today. At 2,000 it becomes a merge conflict magnet. Right now it handles boss phase transitions, status effect application, ability resolution, and flee logic all in one file. Any two of those changing in the same sprint is a conflict. The iteration never forced the issue, but we're one feature away from it.

**Set bonus and passive effects are still implicitly coupled through slot scanning.** The bugs in `SetBonusManager` and `PassiveEffectProcessor` (#509, #514, #516) both traced back to independent slot-scanning logic that didn't agree on slot order. We fixed the immediate bugs, but the root cause â€” two systems doing their own slot walks â€” is still there. We papered it over, we didn't design around it.

**Test coverage on boss phase transitions is thin.** `CombatEngineTests.cs` has 25 test methods for a 1,659-line file. Boss phase transitions (`ExecuteBossPhaseAbility`) were wired in #494/#495 but don't have dedicated phase-boundary tests. The simulation tests cover win-rate but not whether the right phase triggered at the right HP threshold.

**The `StubCombatEngine` is drifting from `CombatEngine`.** Every time a new ability or status effect gets added to the live engine, the stub has to be manually kept in sync. It hasn't caused a test false-positive yet, but it's going to.

### Romanoff (Tester)
**Bugs were introduced in the same PRs that were supposed to fix bugs.** This is the most serious pattern I observed. The arrow-key duplication bug, the Ranger-looping class select, the border misalignment â€” these didn't arrive from nowhere. They were introduced during the IMenuNavigator migration. That means our implementation PRs weren't tested against the full UI behavior surface before merge. A PR that adds a feature shouldn't be able to introduce a regression that requires a separate bug-hunt iteration to find.

**The deep bug hunt was reactive, not proactive.** Finding 19 bugs in a structured hunt is impressive. But those 19 bugs existed in merged code. A dedicated bug hunt after feature work is better than no bug hunt â€” but it's still remediation, not prevention. We were cleaning up after ourselves rather than catching issues at the gate.

**Test coverage for IMenuNavigator is surface-level.** We have 689 tests passing, but I'm not confident we have deep coverage of the navigator's edge cases: what happens when the menu has one item? What happens on rapid input? What happens if the terminal is resized mid-navigation? The tests exist, but they cover the happy path more than the failure surface.

**The "Closes #N" rule (P0-2) is still applied inconsistently.** I reviewed commit messages during this iteration. The rule is in place but enforcement is patchy â€” some commits reference the issue, some reference the PR, some reference neither. If this rule matters (and it does), it needs to be checked before merge, not discovered after.

### Fury (Content Writer)
**Floors 6, 7, and 8 are content stubs â€” and nobody noticed.** Floor 6 (Void Antechamber), Floor 7 (Bone Palace), Floor 8 (Final Sanctum) each have only 4 room descriptions. Floor 1 has 16. The final sanctum has the least content density of any zone. The climax of the game has the least content.

**Band numbering in `RoomDescriptions.cs` is swapped in the doc comments.** The header comment says "Band 3 = F5-6 (Volcanic / Fire)" and "Band 4 = F7-8 (Undead / Lich Domain)". But the static arrays are labeled the opposite way. The mapping in code is correct; the comments on the arrays are wrong.

**Item flavor text is almost entirely functional, not atmospheric.** Items are described by their mechanical utility. Boss Key: "Proof of your victory." Skeleton drop: "A corroded blade." These read like inventory tooltips. No item currently communicates anything about where it came from, who made it, or what it costs to carry it. Given that picking up loot is one of the most frequent player interactions, this is an atmosphere drain at a high-frequency moment.

**Class descriptions don't earn the card real estate.** The class selection screen now renders beautiful bordered cards. The descriptions filling those cards read like stat tooltips, not class fantasies. Rogue: "Balanced. Extra dodge chance." â€” this is particularly flat. A rogue is a shadow, a blade between ribs, not a balanced individual with a dodge trait.

**No content review was built into the merge process for UI changes.** When the Warrior icon bug was introduced and then fixed across multiple rounds, nobody checked whether the fix preserved the spacing and line breaks that make class description text readable inside the card. Content has no gate in the current PR process.

### Fitz (DevOps)
**The closes-reference step is a `warning`, not a `failure`.** P0-2 says `Closes #N` is required. The CI step enforces it with `::warning::` â€” which means PRs without it still merge. That's not enforcement, that's a suggestion. If P0-2 is a hard rule, the step needs to `exit 1` on violation.

**The 12 open issues / 4 open PRs problem had no automated alert.** The Boss had to call out the PR/issue backlog pile-up manually. We have `squad-heartbeat.yml` to detect this, but it's `workflow_dispatch` only â€” it fires when Ralph is explicitly triggered, not on a schedule. A bloated backlog is a systemic signal that should surface automatically.

**Coverage threshold is stale at 62%.** We started at 70%, walked it back to 62% to accommodate the growing codebase. With 689 tests and the bug hunt adding targeted coverage for all 19 bugs, we're almost certainly sitting above 70% actual coverage right now. A threshold that the codebase routinely exceeds by a large margin provides no real protection.

**No PR age / stale PR automation.** At peak, there were 4 open PRs simultaneously. There was no automated nudge when a squad PR sat unreviewed for more than a session. If a `squad/*` branch PR is open for more than 24 hours with passing CI and no review activity, the pipeline should comment and flag it.

### Ralph (Work Monitor)
**The 12-issues/4-PRs pile-up was a queue failure.** The team was filing issues while PRs were still open and unlabeled, and there was no mechanism forcing a stop. The directive that came out of it is correct, but it took the Boss calling it out explicitly rather than the process catching it automatically. The queue let it accumulate silently.

**Duplicate issues happened because filing was fast and individual, not coordinated.** Issues #590/#592, #589/#591, #593/#594 â€” these are the same bugs filed by different agents without cross-checking. In a rapid multi-agent hunt, this is predictable. But it means the queue had phantom items in it during triage, which inflates apparent backlog and creates noise.

**The bug hunt didn't have a defined "done" condition when it started.** From a work-queue perspective, an unbounded hunt creates an unbounded backlog spike. 19 bugs is great to find. But the queue went from 0 to 21 issues instantaneously with no pre-negotiated ceiling, which is a planning risk.

**Labels were inconsistently applied during the UI inconsistency round.** Issues #589, #590, #593, #599 had no labels on close. Issues #591, #592, #594 had both `bug` and `agent:Hill`. Inconsistent labeling means routing rules don't fire reliably, and aggregate metrics are unreliable.

---

## ğŸ“‹ Action Items

| # | Action | Owner | Priority |
|---|--------|-------|----------|
| 1 | Fix failing test `RecordRunEnd_CalledForCombatDeath_HistoryContainsEntry` or explicitly mark `[Skip]` with documented reason | Hill/Romanoff | P0 |
| 2 | Complete IMenuNavigator migration â€” resolve issue #586, wire remaining 10 `ReadLine()` call sites in GameLoop through navigator | Hill | P0 |
| 3 | Harden closes-reference check to hard failure (change `::warning::` to `exit 1` in `squad-ci.yml`) | Fitz | P0 |
| 4 | Add scheduled backlog-health check to `squad-heartbeat.yml` (cron trigger, flag if >3 open PRs or >8 open issues) | Fitz | P0 |
| 5 | Expand Floors 6, 7, 8 to 12 descriptions each (endgame should not have the sparsest narration) | Fury | P0 |
| 6 | Add visual rendering checklist to PR template (display changes must include manual render verification) | Coulson | P1 |
| 7 | Split `DisplayService.cs` and `GameLoop.cs` before next major feature (structural fix to eliminate merge conflict risk) | Hill | P1 |
| 8 | Split `CombatEngine.cs` into focused components: `CombatEngine`, `BossPhaseController`, `AbilityResolver`, `FleeHandler` | Barton | P1 |
| 9 | Unify slot scanning into single `EquipmentSlotWalker` utility (closes root cause of #509/#514/#516) | Barton | P1 |
| 10 | Add boss phase transition tests â€” one test per boss, per phase boundary | Barton/Romanoff | P1 |
| 11 | Define explicit interface contract on `StubCombatEngine` (unsupported methods should throw `NotSupportedException`) | Barton | P1 |
| 12 | Write edge-case tests for IMenuNavigator (single-item menus, empty menus, rapid input, terminal resize, escape behavior) | Romanoff | P1 |
| 13 | Add pre-merge test checklist to PR template (all tests pass, new tests cover changed behavior, UI changes visually verified) | Romanoff | P1 |
| 14 | Establish "no new bugs in fix PRs" norm (fix PRs must include regression tests) | Romanoff | P1 |
| 15 | Bug-hunt gate at end of each feature phase (structured hunt before phase complete, don't wait for accumulation) | Romanoff | P1 |
| 16 | Ratchet coverage threshold to 70% in `squad-ci.yml` (confirm current coverage first, then lock and document) | Fitz/Romanoff | P1 |
| 17 | Post Stryker mutation score to workflow summary (parse output, write to `$GITHUB_STEP_SUMMARY`) | Fitz | P1 |
| 18 | Fix Band numbering doc comments in `RoomDescriptions.cs` (correct Band 3/4 labels on arrays) | Fury | P1 |
| 19 | Rewrite class short descriptions with voice, not stat summaries (~50 chars, communicate who the player becomes) | Fury | P1 |
| 20 | Write second pass of item flavor text for enemy drops (6-10 words with atmosphere, prioritize boss drops) | Fury | P1 |
| 21 | Document terminal width assumption (single constant or `ConsoleLayout` helper for card borders and navigator) | Hill | P2 |
| 22 | Add soft branch-name validation in CI (check against `^(squad\|scribe\|fitz\|fix\|feat\|docs\|chore)/`, emit warning) | Fitz | P2 |
| 23 | Stale PR notification in heartbeat workflow (flag PRs open >48h with passing CI, no review activity) | Fitz | P2 |
| 24 | Add content-layout checkpoint to UI change checklist (verify text renders without clipping in all 6 class cards) | Coulson/Fury | P2 |
| 25 | Label enforcement: `bug` label required on all bug issues before close (add GitHub Actions check) | Fitz/Ralph | P2 |
| 26 | Bug hunt scope agreement before launch (agree on subsystems, issue ceiling, file-first vs fix-now strategy) | Coulson/Ralph | P2 |
| 27 | Board check at session start is mandatory (run `gh issue list` + `gh pr list` before any new work spawned) | Ralph | P2 |
| 28 | Queue cap rule: max 8 open issues triggers mandatory pause (no new issues/features until queue drops below 4) | Ralph | P2 |
| 29 | Duplicate check step before filing in multi-agent bug hunts (run `gh issue list --search` before `gh issue create`) | Ralph | P2 |
| 30 | Track test coverage per subsystem, not just total count (per-subsystem coverage in session log to identify gaps) | Romanoff | P2 |

---

## ğŸ Facilitator Synthesis (Coulson)

This iteration landed a foundational abstraction (`IMenuNavigator`), cleared a 12-issue/4-PR backlog, and hunted down 19 bugs across three clean PRs. The team ended at 0 open issues, 0 open PRs, and 689 passing tests. That's a disciplined recovery and a baseline to hold.

But the retrospective also surfaced a recurring pattern: **we're building process rules to compensate for structural problems in the code.** The P1-4 merge sequence rule exists because `DisplayService.cs` and `GameLoop.cs` are 1,400+ lines each. The "Closes #N" warning exists but doesn't block because we haven't hardened enforcement. The backlog pile-up required a directive because we had no automated alert. The visual rendering bugs took multiple rounds because we're code-reviewing display output instead of looking at it. These are all solvable.

The action items fall into three buckets:
1. **P0 blockers** â€” failing test, incomplete migration, weak CI enforcement, endgame content gaps
2. **P1 structural work** â€” split oversized files, unify duplicated logic, add missing test coverage, rewrite content with voice
3. **P2 process hygiene** â€” label enforcement, queue caps, session startup discipline

The team's strongest capability right now is **finding and fixing bugs systematically**. The gap is **catching them earlier**. The test suite is real, the simulation tests are paying dividends, and the abstraction boundaries (ICombatEngine, IMenuNavigator) held under pressure. The work ahead is making the structural improvements that turn reactive quality into proactive quality â€” and making the process rules automatic instead of aspirational.

**Key observations on team health:**
- **Collaboration worked.** Three agents hunted bugs in parallel without stepping on each other. PRs merged clean.
- **The directive landed.** "Work not complete with open issues/PRs" is now canonical and enforced by the team, not just the Boss.
- **Agent specialization is clear.** Each domain (display, systems, testing, content, CI, queue) had grounded, specific input. No overlap, no gaps.
- **Honesty is high.** The retro surfaced real problems (god objects, incomplete migrations, content stubs) without defensiveness. That's the foundation for improvement.

Next iteration: P0 items are blockers. P1 structural work should be scheduled before the next feature sprint, not deferred. P2 items are incremental hygiene that compounds over time.

---

## ğŸ“Œ Process Decisions Carried Forward

See `.ai-team/decisions/inbox/retro-decisions-2026-02-27.md` for new decisions requiring review and merge.

---

*Retrospective facilitated by Coulson on 2026-02-27*  
*Written to: `.ai-team/log/retro-2026-02-27.md`*
